<!-- In this template we are using a function defined in nbbajax.js and jquery.genxmlajax.js so include the script here -->
<script type="text/javascript" src="/DesktopModules/NBright/NBrightBuy/js/nbbajax.js"></script>
<script src="/DesktopModules/NBright/NBrightBuy/js/jquery.genxmlajax.js" type="text/javascript"></script>
<!-- return field for ajax calls -->
[<tag id="nbxrtn" type="hidden" />]
[<tag id="nbxprocessing" type="hidden" />]
[<tag id="nbxaction" type="hidden" />]

<script>

    $(document).ready(function () {

        //get category data from server via ajax.
        nbxonclick('select[[id*="categorylistbox"]]', 'getcategoryadminform', '#categoryselect', 'get')

        // ajax call returned data, so action based on the action being done.
        $('input[[id*=nbxrtn]]').change(function () {
            if ($('input[[id*="nbxaction"]]').val() == 'get') {
                //we need this event to pick up the data returned and move it into the correct div as html
                //$('#texteditor').appendTo($('#texteditorstartpos'));
                $('#categorydata').html($(this).val());
                $('#texteditor').appendTo($('#texteditoreditpos'));
				//$('#texteditor').show();
            }
        });

        $('input[[id *= "nbxprocessing"]]').change(function () {
            if ($('input[[id*="nbxaction"]]').val() == 'setcategory' && $('input[[id*="nbxprocessing"]]').val() == 'AFTER') {
                // first update of non-localized fields complated, so updated the localized ones.
                nbxget('setcategoryadminform', '#cateogrylangfields', 'setcategorylang'); // stage 2 update
            }
            if ($('input[[id*="nbxaction"]]').val() == 'setcategorylang' && $('input[[id*="nbxprocessing"]]').val() == 'AFTER') {
                // localized fields updated, operation finished, display message.
                $('#notifymsg').html($('input[[id*=nbxrtn]]').val());
            }
        });

        // save the category data, 2 stages: non-localized and localized fields.
        $('#categorysave').click(function () {
			nbxget('setcategoryadminform', '#cateogryfields', 'setcategory'); // stage 1 update
        });

    });

</script>
<div id="notifymsg"></div>

<div>
<div id="categoryselect" style="float:left;width:300px;">
CATEGORY LIST
[<tag id="categorylistbox" type="catlistbox" height="500px" />]
<br />
<div id="categorysave"> SAVE BUTTON </div>
</div>
<div id="categorydata" style="float:left;">
CATEGORY DATA
</div>
<div style="clear:both;"></div>
</div>
<!-- we can't use ajax to render the richtext editor, so render it with the normal template -->
<div id="texteditorstartpos"></div>
<div id="texteditoreditpos"></div>

<div id="texteditor" >
[<tag id="message" type="dnn:texteditor" height="400" width="800"  editinrole="" viewinrole="" />]
</div>

[<tag id="includeinheader" type="meta" value="pageheader.html" />]<!-- This template injects into page head section with static data only -->

<!-- This loader needs to be made to work here -->
<div id="loader" class="processing" style="display:none">[<tag type="htmlof" resourcekey="Cartview.ProcessingDiv" />]</div>

<!-- Layout template -->
<div id="cartdetails" class="nbs dnnform">
<div id="cartlist"></div>
<div id="cartbilladdress" class="panel"></div>
<div id="cartshippingoptions" class="panel"></div>
<div id="cartshippingmethods" class="panel"></div>
<div id="cartextra" class="panel"></div>
</div>

<script type="text/javascript">
    $(document).ready(function () {

        // JQuery used to move cart elements into required area 
        $('#cartbilladdress').append($('.checkoutbillform'));
        $('#cartshippingoptions').append($('#shippingoptions'));
        $('#cartshippingmethods').append($('#shippingmethods'));
        $('#cartshippingoptions').append($('.checkoutshipform'));
        $('#cartshippingoptions').append($('.checkoutship'));
        $('#cartextra').append($('.checkoutextra'));
        $('#cartlist').append($('#checkoutitemlist'));

        $('.checkoutbillform').show();
        $('.checkoutshipform').show();
        $('.checkoutextra').show();
        $('#checkoutitemlist').show();
        $('#shippingoptions').show();
        $("a[[id*='cmdSaveShipAddress']]").hide();
        $("#selectshipaddress").hide();

        //hide/show shipping option
        if ($("input[[id*='rblshippingoptions']]:checked").val() == "2") $('#shippinginput').show();
        if ($("input[[id*='rblshippingoptions']]:checked").val() == "3") {
            $('.checkoutship').show();
            $('#cartshippingmethods').hide();
            $('#providertemplates').hide();
        }

        $("input[[id*='rblshippingoptions']]").change(function () {
            $('.checkoutship').hide();
            $('#shippinginput').hide();
            $("a[[id*='cmdSaveShipAddress']]").hide();
            $("#selectshipaddress").hide();
            $("#shippinginput").find('input').attr('disabled', 'disabled');
            $('#cartshippingmethods').show();
            if ($(this).val() == "2") {
                $('#shippinginput').show();
                $("a[[id*='cmdSaveShipAddress']]").show();
                $("#selectshipaddress").show();
                $("#shippinginput").find('input').removeAttr('disabled');
            }
            if ($(this).val() == "3") {
                $('.checkoutship').show();
                $('#cartshippingmethods').hide();
                $('#providertemplates').hide();
            }
            if ($(this).val() != "3") $("input[[id*='_cmdConfirm_']]").trigger("click");
        });


        $("select[[id*='selectaddress']]").change(function () {
            populateAddressForm($(this).attr('formselector'), $(this).find('option:selected').attr('datavalue'), $(this).find('option:selected').attr('data'));
        });

        function populateAddressForm(selectordiv, datavalue, data) {
            // Take the address dropdown data and popluate the address for with it.
            // selectordiv = the selector for the form section that needs popluating
            // datavalue = the list of field ids that need popluating (in seq order matching the "data" param)
            // data = the list of data values to be populated.
            if (data != null && data != '') {
                var datarray = data.split(',');
                var valuearray = datavalue.split(',');
                var arrayLength = valuearray.length;
                for (var i = 0; i < arrayLength; i++) {
                    $(selectordiv).find("[[id*='" + valuearray[[i]] + "']]").val(datarray[[i]]);
                }
            }
        }

        // auto fire postback when the country dropdown is changed. 
        $("select[[id*='_Country_']]").change(function () {
            $("input[[id*='_cmdConfirm_']]").trigger("click");
    });
        // auto fire postback when the region dropdown is changed. 
        $("select[[id*='_Region_']]").change(function () {
            $("input[[id*='_cmdConfirm_']]").trigger("click");
        });

        // auto fire postback when the shipping providerdropdown is changed. 
        $("input[[id*='_shippingprovider_']]").change(function (e) {
            $("input[[id*='_cmdConfirm_']]").trigger("click");
        });

        // disable validation on hidden controls
        if ($('#shippinginput').is(':visible')) {
            $("#shippinginput").find('input').removeAttr('disabled');
        }
        else {
            $("#shippinginput").find('input').attr('disabled', 'disabled');
        }

        // update the order email with the billing email, if it's not already there
        $('.checkoutbillform input[[id*="_Email_"]]').change(function(e) {
            if ($('input[[id*="_cartemailaddress_"').val() == '') $('input[[id*="_cartemailaddress_"').val($(this).val());
        });

    });
</script>
